# 本地部署任务分解文档

## 核心目标
让 RAGFlow 在本地跑起来，能跑通即可。基础设施（MySQL、Redis、MinIO、Elasticsearch）继续使用现有的 Docker 容器，只需要将 RAGFlow 主服务迁移到本地运行。

## 简化任务列表

- [ ] 1. 创建 feature 分支并拉取最新代码
  - 使用命令行操作：`git checkout -b feature/local-deployment`
  - 拉取最新代码：`git pull origin main`
  - 目的：在专门分支上进行开发，便于后续贡献到官方仓库
  - _复用：现有 Git 工作流_
  - _需求：1.1, 1.2, 1.5_
  - _提示：角色：开发者 | 任务：创建 feature 分支并同步最新代码 | 限制：处理可能的合并冲突 | 成功标准：分支创建成功，代码同步完成_

- [ ] 2. 安装 Python 依赖
  - 使用命令行操作：`uv sync` 或 `uv install`
  - 确保 Python 版本兼容（3.10-3.12）
  - 目的：准备本地运行环境
  - _复用：pyproject.toml, uv.lock_
  - _需求：5.1, 5.2_
  - _提示：角色：开发者 | 任务：安装项目依赖 | 限制：使用 uv 包管理器 | 成功标准：依赖安装成功，无版本冲突_

- [ ] 3. 修改配置文件适配本地部署
  - 复制并修改 `conf/service_conf.yaml`
  - 将容器服务地址改为 localhost 端口映射
  - 目的：让本地服务能连接到 Docker 容器中的基础设施
  - _复用：现有配置文件和端口映射_
  - _需求：3.1, 3.2_
  - _提示：角色：开发者 | 任务：修改配置文件中的服务地址 | 限制：保持配置格式不变 | 成功标准：配置文件正确，服务地址指向本地端口_

- [ ] 4. 创建本地启动脚本
  - 文件：`start_local.py` 或 `start_local.sh`
  - 简单的启动脚本，调用 `python api/ragflow_server.py`
  - 可选：添加重启功能和基本的错误处理
  - 目的：提供便捷的启动方式
  - _复用：api/ragflow_server.py_
  - _需求：4.1, 4.2_
  - _提示：角色：开发者 | 任务：创建简单的启动脚本 | 限制：保持简单，不过度复杂化 | 成功标准：脚本能够启动服务，支持基本的重启功能_

- [ ] 5. 测试本地部署
  - 启动现有的 Docker 基础设施：`docker-compose -f docker/docker-compose-base.yml up -d`
  - 运行本地启动脚本，验证服务启动
  - 测试基本功能：访问 Web 界面，验证服务连接
  - 目的：确保本地部署能够正常工作
  - _复用：现有的 Docker 配置和测试方法_
  - _需求：6.1, 6.2_
  - _提示：角色：开发者 | 任务：测试完整的本地部署流程 | 限制：确保不影响现有 Docker 部署 | 成功标准：服务启动成功，基本功能正常_

- [ ] 6. 编写简单的使用文档
  - 文件：`docs/local-deployment.md`
  - 记录部署步骤、配置说明、常见问题
  - 提供快速开始指南
  - 目的：帮助其他开发者使用本地部署
  - _复用：现有文档格式_
  - _需求：所有需求_
  - _提示：角色：技术文档编写者 | 任务：编写简洁的使用文档 | 限制：保持文档简单易懂 | 成功标准：文档清晰，其他开发者能够按照文档完成部署_

## 实施说明

这个简化版本专注于核心目标：让 RAGFlow 在本地跑起来。避免了复杂的自动化工具开发，主要通过手动命令行操作和简单脚本来实现。整个过程应该在几小时内完成，而不是几天或几周。

### 关键简化点：
1. **Git 操作**：直接使用命令行，不开发复杂的分支管理器
2. **基础设施管理**：复用现有 Docker 配置，不进行额外管理
3. **配置生成**：手动修改配置文件，不开发自动化生成器
4. **服务启动**：简单的启动脚本，不开发复杂的服务管理器
5. **依赖管理**：直接使用 uv 命令，不开发依赖管理器
6. **测试**：基本的功能验证，不开发复杂的测试套件
